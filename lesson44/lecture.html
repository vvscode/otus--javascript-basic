<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <title>Занятие 44</title>
    <link rel="shortcut icon" href="./../favicon.ico" />
    <link rel="stylesheet" href="./../dist/reset.css" />
    <link rel="stylesheet" href="./../dist/reveal.css" />
    <link rel="stylesheet" href="./../dist/theme/white.css" id="theme" />
    <link rel="stylesheet" href="./../css/highlight/base16/zenburn.css" />

    <link rel="stylesheet" href="./../_assets/.reveal-md/styles.css" />


    <script>
      document.write(
        '<script src="http://' +
          (location.host || 'localhost').split(':')[0] +
          ':35729/livereload.js?snipver=1"></' +
          'script>'
      );
    </script>
  </head>
  <body>
    <div class="reveal">
      <div class="slides"><section ><section data-markdown><script type="text/template">

# OTUS

## Javascript Basic

</script></section><section data-markdown><script type="text/template">

Вопросы?

</script></section></section><section ><section data-markdown><script type="text/template">

### [React.Component](https://ru.reactjs.org/docs/react-component.html)

</script></section><section data-markdown><script type="text/template">

1. [`setState`](https://github.com/facebook/react/blob/master/packages/react/src/ReactBaseClasses.js#L57)
1. [`forceUpdate`](https://github.com/facebook/react/blob/master/packages/react/src/ReactBaseClasses.js#L82)
1. [`render`](https://ru.reactjs.org/docs/react-component.html#render) - единственный обязательный метод в классовом компоненте

</script></section><section data-markdown><script type="text/template">

Общая схема методов, которые могут быть определены (и порядок вызова этих методов) отражен на [диаграмме](https://projects.wojtekmaj.pl/react-lifecycle-methods-diagram/).

</script></section><section data-markdown><script type="text/template">

С точки зрения TS [`React.Component` является generic с двумя (на самом деле тремя) параметрами](https://github.com/DefinitelyTyped/DefinitelyTyped/blob/master/types/react/index.d.ts#L433) - для описания `props` (какие свойства могут быть переданы в элемент) и `state` (какая структура описывает внутреннее состояние элемента).

</script></section><section data-markdown><script type="text/template">

Для описания пропсов компонентов может так же служить пакет [PropTypes](https://www.npmjs.com/package/proptypes) - но он не имеет особого смысла в TS-окружении

</script></section><section data-markdown><script type="text/template">

Вопросы?

</script></section><section data-markdown><script type="text/template">

[Практика](https://codesandbox.io/s/github/vvscode/otus--javascript-basic/tree/master/lessons/lesson44/code/counter-button):

реализовать кнопку-счетчик. Изначально кнопка отрисовывается со значением `0`. При каждом клике значение в кнопке должно увеличиваться на единицу.

</script></section><section data-markdown><script type="text/template">

Обратите внимание на метод [`setState`](https://ru.reactjs.org/docs/react-component.html#setstate) и его корректное использование, когда новое значение строится на основе прошлого.

</script></section><section data-markdown><script type="text/template">

Вопросы?

</script></section></section><section ><section data-markdown><script type="text/template">

### Оговорка про функциональные компоненты с хуками (имеющими внутреннее состояние)

</script></section><section data-markdown><script type="text/template">

С версии [React 16.8](https://ru.reactjs.org/blog/2019/02/06/react-v16.8.0.html) поддерживаются функциональные компоненты, которые могут иметь [состояние и реализовывать некоторые другие возможности классовых компонентов](https://ru.reactjs.org/docs/hooks-intro.html).

</script></section><section data-markdown><script type="text/template">

```tsx [1-30]
import { useState } from "react";

export default function App() {
  const [counter, setCounter] = useState(0);
  return (
    <button onClick={() => setCounter((counter) => counter + 1)}>
      {counter}
    </button>
  );
}
```

</script></section><section data-markdown><script type="text/template">

> [Хуки решают множество, казалось бы, несвязанных между собой, проблем в React, с которыми мы сталкивались в течение пяти лет написания и поддержки десятков тысяч компонентов](https://ru.reactjs.org/docs/hooks-intro.html#motivation)

</script></section><section data-markdown><script type="text/template">

- [Трудно повторно использовать логику состояний между компонентами](https://ru.reactjs.org/docs/hooks-intro.html#its-hard-to-reuse-stateful-logic-between-components)
- [Сложные компоненты становятся трудными для понимания](https://ru.reactjs.org/docs/hooks-intro.html#complex-components-become-hard-to-understand)
- [Классы путают как людей, так и машины](https://ru.reactjs.org/docs/hooks-intro.html#classes-confuse-both-people-and-machines)

</script></section><section data-markdown><script type="text/template">

[FAQ](https://ru.reactjs.org/docs/hooks-faq.html):

> Хуки не изменили фундаментальную логику React, поэтому ваши знания компонентов, пропсов и нисходящего потока данных остаются актуальными.

> Однако, хуки — не самая простая часть React.

</script></section><section data-markdown><script type="text/template">

Вопросы?

</script></section></section><section ><section data-markdown><script type="text/template">

### Smart and dumb components

</script></section><section data-markdown><script type="text/template">

Один из паттернов (некоторые его называют устаревшим, но это все еще реализация разделения ответственности) - разделение компонентов на:

- отвечающие за внешний вид и отображение
- отвечающие за логику (в том числе загрузку данных)

</script></section><section data-markdown><script type="text/template">

Презентационные компоненты (глупые компоненты):

- содержат разметку и логику представления
- (почти) не содержат своего собственного состояния
- легко могут быть переиспользованы (в идеале являются отображением props на UI)

</script></section><section data-markdown><script type="text/template">

Компоненты-контейнеры (умные компоненты):

- отвечают за загрузку данных (или отправку команд на такую загрузку)
- отвечают за логику взаимодействия с пользователем (а иногда не только с ним)
- в `render` делают композицию презентационных компонентов (передавая им данные через props)

</script></section><section data-markdown><script type="text/template">

Но т.к. пользователь взаимодействует как раз с презентационной частью, дополнением идеи является паттерн ["контролируемый ввод" (state hoisting + controlled input = unidirectional data flow)](https://reactpatterns.com/#controlled-input)

</script></section><section data-markdown><script type="text/template">

<img src="./images/unidirectional-data-flow.png" />

</script></section><section data-markdown><script type="text/template">

```tsx [1-30]
function CounterButton({
  value,
  inc,
  dec,
}: {
  value: number;
  inc: () => void;
  dec: () => void;
}) {
  return (
    <>
      <button onClick={dec}>-</button>
      {value}
      <button onClick={inc}>+</button>
    </>
  );
}
```

</script></section><section data-markdown><script type="text/template">

```tsx [1-30]
export class Counter extends React.Component<{}, { value: number }> {
  state = {
    value: 5,
  };

  inc = () =>
    this.setState((state) => ({
      value: state.value + 1,
    }));

  dec = () =>
    this.setState((state) => ({
      value: state.value - 1,
    }));

  render() {
    return (
      <CounterButton value={this.state.value} inc={this.inc} dec={this.dec} />
    );
  }
}
```

</script></section><section data-markdown><script type="text/template">

[Sandbox](https://codesandbox.io/s/github/vvscode/otus--javascript-basic/tree/master/lessons/lesson44/code/controlled-counter)

</script></section><section data-markdown><script type="text/template">

Вопросы?

</script></section></section><section ><section data-markdown><script type="text/template">

### Домашнее задание

</script></section><section data-markdown><script type="text/template">

Необходимо:

1. создать и настроить проект
2. настроить [storybook](https://storybook.js.org/docs/react/get-started/introduction)
3. настроить тесты с [loki](https://loki.js.org/)
4. создать глупые компоненты (модификация поведения и передача параметров должна делаться через props):

- заголовок (с поддержкой уровней)
- параграф текста (с разными стилями - обычный, цитата, полужирный)
- пробельный блок (с горизонтальной линией)
- схлопывающийся блок (может сворачиваться в заголовок или показывать контент)
- картинка (с вариантами обтекания)
- колонки (с переменным числом колонок)

</script></section><section data-markdown><script type="text/template">

5. создать умный компонент, который запрашивает у пользователя данные и выводит их на страницу - в цикле (пока ответ не будет пустой) спрашивает имя компонента (из списка выше), какие ему нужны свойства (в зависимости от компонента) (можно взять простейшую реализацию с `prompt`)
6. опубликовать storybook на github pages
7. подготовить работу с сдаче (покрытие кода от 60%, использовать [RTL](https://testing-library.com/docs/react-testing-library/))
8. сделать ревью 2 других работ
9. сбросить ссылку на PR, опубликованный проект и рассмотренные пуллреквесты в част с преподавателем

</script></section><section data-markdown><script type="text/template">

Вопросы?

</script></section></section><section  data-markdown><script type="text/template">

### Дополнительные материалы

1. [Умные и глупые компоненты React](https://habr.com/ru/post/266559/)
1. [Тупые и умные компоненты](https://habr.com/ru/company/epam_systems/blog/519856/)
1. [Presentational and Container Components](https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0)
1. [Контейнеры и компоненты](https://max-frontend.gitbook.io/redux-course-ru-v2/sozdanie/konteineri-i-komponenti)
1. [Container component](https://reactpatterns.com/#container-component)
</script></section></div>
    </div>

    <script src="./../dist/reveal.js"></script>

    <script src="./../plugin/markdown/markdown.js"></script>
    <script src="./../plugin/highlight/highlight.js"></script>
    <script src="./../plugin/zoom/zoom.js"></script>
    <script src="./../plugin/notes/notes.js"></script>
    <script src="./../plugin/math/math.js"></script>
    <script>
      function extend() {
        var target = {};
        for (var i = 0; i < arguments.length; i++) {
          var source = arguments[i];
          for (var key in source) {
            if (source.hasOwnProperty(key)) {
              target[key] = source[key];
            }
          }
        }
        return target;
      }

      // default options to init reveal.js
      var defaultOptions = {
        controls: true,
        progress: true,
        history: true,
        center: true,
        transition: 'default', // none/fade/slide/convex/concave/zoom
        plugins: [
          RevealMarkdown,
          RevealHighlight,
          RevealZoom,
          RevealNotes,
          RevealMath
        ]
      };

      // options from URL query string
      var queryOptions = Reveal().getQueryHash() || {};

      var options = extend(defaultOptions, {"slideNumber":true,"hash":true,"history":false,"backgroundTransition":"fade","width":"80%"}, queryOptions);
    </script>


    <script>
      Reveal.initialize(options);
    </script>
  </body>
</html>
