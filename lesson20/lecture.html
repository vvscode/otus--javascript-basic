<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <title>Занятие 20</title>
    <link rel="shortcut icon" href="./../favicon.ico"/>
    <link rel="stylesheet" href="./../dist/reveal.css" />
    <link rel="stylesheet" href="./../dist/theme/white.css" id="theme" />
    <link rel="stylesheet" href="./../css/highlight/zenburn.css" />
    <link rel="stylesheet" href="./../_assets/.reveal-md/styles.css" />

    <script>
      document.write('<script src="http://' + (location.host || 'localhost').split(':')[0] + ':35729/livereload.js?snipver=1"></' + 'script>');
    </script>
  </head>
  <body>
    <div class="reveal">
      <div class="slides"><section ><section data-markdown><script type="text/template">

# OTUS

## Javascript Basic

</script></section><section data-markdown><script type="text/template">

### Вопросы?

</script></section></section><section ><section data-markdown><script type="text/template">

## Настройка окружения для современной разработки на TS

</script></section><section data-markdown><script type="text/template">

Typescript, хоть и очень похож на Javascript, все же отличается. Поэтому для преобразования кода в [AST](https://ru.wikipedia.org/wiki/%D0%90%D0%B1%D1%81%D1%82%D1%80%D0%B0%D0%BA%D1%82%D0%BD%D0%BE%D0%B5_%D1%81%D0%B8%D0%BD%D1%82%D0%B0%D0%BA%D1%81%D0%B8%D1%87%D0%B5%D1%81%D0%BA%D0%BE%D0%B5_%D0%B4%D0%B5%D1%80%D0%B5%D0%B2%D0%BE) нужны другие инструменты.

Подробнее про AST [тут](https://habr.com/ru/company/ruvds/blog/415269/)

</script></section><section data-markdown><script type="text/template">

### Prettier

</script></section><section data-markdown><script type="text/template">

[Работает с TS из-коробки](https://prettier.io/blog/2017/06/03/1.4.0.html)

[При необходимости можно задать парсер для Typescript](https://prettier.io/docs/en/options.html#parser)

</script></section><section data-markdown><script type="text/template">

### Eslint

</script></section><section data-markdown><script type="text/template">

[TSLint](https://palantir.github.io/tslint/) - An extensible linter for the TypeScript language.

TSLint has been deprecated as of 2019

</script></section><section data-markdown><script type="text/template">

Если запустить eslint в TS окружении, вроде ничего и не произойдет.

Потому что eslint по умолчанию проигнорирует ts файлы.

```bash
# Для проверки TS-файлов
npx eslint . --ext .js,.ts
```

</script></section><section data-markdown><script type="text/template">

После этого eslint начнет проверять Typescript файлы, но будет падать с ошибками, если вы используете указания типов.

Решение - [typescript-eslint](https://github.com/typescript-eslint/typescript-eslint)

</script></section><section data-markdown><script type="text/template">

Некоторые правила нужно подправить, потому что они дублируют/конфликтуют с Typescript

<!-- eslint-skip -->

```js
{
  "import/no-unresolved": "off", // https://github.com/typescript-eslint/typescript-eslint/issues/1624
  "import/extensions": ["warn", "never"] // https://github.com/benmosher/eslint-plugin-import/blob/master/docs/rules/extensions.md
}
```

</script></section><section data-markdown><script type="text/template">

### Проверка работы с типами

</script></section><section data-markdown><script type="text/template">

На соответствие типам проверяется не отдельный файл, а весь проект. Для этого нужно попытаться собрать проект - если это прошло успешно, значит проверки прошли.

```bash
npx tsc --noEmit
```

Эта проверка становится частью `lint` скрипта.

</script></section><section data-markdown><script type="text/template">

### Jest

</script></section><section data-markdown><script type="text/template">

Jest уже обрабатывает наши файлы с помощью babel. Зачем?

</script></section><section data-markdown><script type="text/template">

Babel умеет обрабатывать и Typescript при помощи [@babel/preset-typescript](https://babeljs.io/docs/en/babel-preset-typescript)

```bash
npm install @babel/preset-typescript --save-dev
```

```
// babel.config.js
module.exports = {
  presets: [
    ['@babel/preset-env', {targets: {node: 'current'}}],
+    '@babel/preset-typescript',
  ],
};
```

</script></section><section data-markdown><script type="text/template">

### Webpack

</script></section><section data-markdown><script type="text/template">

Есть несколько вариантов интеграции

</script></section><section data-markdown><script type="text/template">

Первым делом нужно научить webpack смотреть на ts файлы, с помощью опции [`resolve.extensions`](https://webpack.js.org/configuration/resolve/#resolveextensions)

```js
// webpack.config.js
module.exports = {
  // ...
  resolve: {
    extensions: [".js", ".ts"],
  },
};
```

</script></section><section data-markdown><script type="text/template">

Дальше нужно научить webpack обрабатывать эти файлы

</script></section><section data-markdown><script type="text/template">

**Вариант 1**: [ts-loader](https://github.com/TypeStrong/ts-loader)

Описывается как [в документации webpack](https://webpack.js.org/guides/typescript/) так и [в документации Typescript](https://www.typescriptlang.org/docs/handbook/integrating-with-build-tools.html#webpack)

</script></section><section data-markdown><script type="text/template">

**Вариант 2**: [babel-loader](https://github.com/babel/babel-loader). Упоминается [в документации к Typescript](https://www.typescriptlang.org/docs/handbook/integrating-with-build-tools.html#babel) и его настройка также описана [в документации к webpack](https://webpack.js.org/loaders/babel-loader/#root) _(только помните про расширение файла)_.

</script></section><section data-markdown><script type="text/template">

Варианты дают немного разный результат ([1](http://evanlouie.github.io/posts/typescript-babel-preset-typescript-ts-loader), [2](https://blog.logrocket.com/choosing-between-babel-and-typescript-4ed1ad563e41/), [3](https://www.mattzeunert.com/2019/10/23/migrating-your-webpack-typescript-build-from-ts-loader-to-babel-loader.html)).

</script></section><section data-markdown><script type="text/template">

### Вопросы?

</script></section></section><section ><section data-markdown><script type="text/template">

## Практика

</script></section><section data-markdown><script type="text/template">

### Вопросы?

</script></section></section><section ><section data-markdown><script type="text/template">

### Домашнее задание

</script></section><section data-markdown><script type="text/template">

Необходимо

- создать новый репозиторий
- инициализировать его с файлом .gitignore
- создать новую ветку (чтобы можно было создать PR)
- настроить линтинг и actions, настроить автодеплой из PR
- сконфигурировать webpack
- добавить поддержку ts файлов
- добавить поддержку импорта css файлов
- реализовать приложение ["Игра Жизнь"](https://ru.wikipedia.org/wiki/%D0%98%D0%B3%D1%80%D0%B0_%C2%AB%D0%96%D0%B8%D0%B7%D0%BD%D1%8C%C2%BB) на языке Typescript
- ссылку на задеплоенную страницу и на пуллреквест сбросить в чат с преподавателем
- настроить jest и написать тесты на приложение

</script></section><section data-markdown><script type="text/template">

Игра должна поддерживать отображение нескольких независимых полей на странице (см пример)

Критерии оценки

- настроена поддержка typescript через babel - 5
- реализовано приложение "Игра Жизнь" - 5 баллов
- реализовано взаимодействие с полем (клик по ячейке меняет ее состояние) - 2
- реализован автостоп игры, когда все клетки умерли - 2
- реализован механизм изменения размеров поля (два input поля type=number), в т.ч. на лету (при увеличении заполнение мертвыми клетками, при уменьшении просто уничтожения ячеек) - 2
- реализован механизм изменения скорости игры (input type=range) - 2
- реализована подсветка клеток, которые являясь живыми должны умереть в следующем поколении (например мертвые - белый цвет, живые - черный, обреченные на смерть - синий) - 2

Принято от 16 баллов

Задание не принимается:

- без тестов
- без настроенного линтинга, хуков, деплоя приложения через github actions

</script></section><section data-markdown><script type="text/template">

### Вопросы?

</script></section></section><section  data-markdown><script type="text/template">

### Опрос о занятии

</script></section><section  data-markdown><script type="text/template">

Дополнительные материалы:

- [Введение в TypeScript](https://metanit.com/web/typescript/1.1.php)
- [Game of life in js](https://github.com/otus-js-student/js--game-of-life)
</script></section></div>
    </div>

    <script src="./../dist/reveal.js"></script>

    <script src="./../plugin/markdown/markdown.js"></script>
    <script src="./../plugin/highlight/highlight.js"></script>
    <script src="./../plugin/zoom/zoom.js"></script>
    <script src="./../plugin/notes/notes.js"></script>
    <script src="./../plugin/math/math.js"></script>
    <script>
      function extend() {
        var target = {};
        for (var i = 0; i < arguments.length; i++) {
          var source = arguments[i];
          for (var key in source) {
            if (source.hasOwnProperty(key)) {
              target[key] = source[key];
            }
          }
        }
        return target;
      }

      // default options to init reveal.js
      var defaultOptions = {
        controls: true,
        progress: true,
        history: true,
        center: true,
        transition: 'default', // none/fade/slide/convex/concave/zoom
        plugins: [
          RevealMarkdown,
          RevealHighlight,
          RevealZoom,
          RevealNotes,
          RevealMath
        ]
      };

      // options from URL query string
      var queryOptions = Reveal().getQueryHash() || {};

      var options = extend(defaultOptions, {"slideNumber":true,"hash":true,"history":false,"backgroundTransition":"fade","width":"80%"}, queryOptions);
    </script>


    <script>
      Reveal.initialize(options);
    </script>
  </body>
</html>
