---
title: Занятие 37
description: Разработка виджетов, микроприложений
---

# OTUS

## Javascript Basic

<!-- v -->

### Вопросы?

<!-- s -->

## Разработка виджетов, микроприложений

<!-- v -->

Причины возникновения микроприложений на клиенте:

- большой размер приложений, с широким функционалом
- желание предоставлять обновления максимально часто (и без влияния на другие части приложения)
- большая команда, что увеличивает частоту релизов

<!-- v -->

Какие инструменты у нас для этого есть?

- разбиение на модули
- снижение связанности

<!-- v -->

Но! В обычном приложении мы все еще создаем модули на одной технологии, в одном репозитории и они работают в неизолированном окружении. Это влияет как на CSS так и на JS (глобальные объекты).

<!-- v -->

Для решения проблем модульности в стилях мы можем использовать:

- [BEM](https://avivi.pro/blog/metodologiya-bem-v-deystvii/) / [CSS модули](https://frontender.info/css-modules-part-1-need/)
- [iframe](https://habr.com/ru/post/488516/)
- [Shadow DOM](https://learn.javascript.ru/shadow-dom)

<!-- v -->

Для решения проблем модульности в JS мы можем использовать:

- [iframe](https://habr.com/ru/post/488516/)
- не использовать глобальные переменные (фактически не возможно)

<!-- v -->

Но это не решает вопрос привязки к технологиям разработки:

- для разных задач хороши разные инструменты
- для разных команд хороши разные инструменты

<!-- v -->

Решением может являться независимая разработка частей. Когда каждый модуль/виджет представлен отдельным (одним или несколькими) js-файлом.

Причем подключать их не обязательно сразу. Не редко используется прием [динамической загрузки скриптов](https://learn.javascript.ru/external-script)

<!-- v -->

```js
function addScript(src) {
  var script = document.createElement("script");
  script.src = src;
  script.async = false; // чтобы гарантировать порядок
  document.head.appendChild(script);
}
// ...
addScript("weaterForm.js");
addScript("weaterHistoryList.js");
```

<!-- v -->

Решением, которое позволяло делать это и гарантировало подключение модулей в качестве зависимостей долгое время была библиотека [require.js](https://requirejs.org/)

```js [1-30]
// my/shirt.js
// https://requirejs.org/docs/api.html#defdep
define(["./cart", "./inventory"], function (cart, inventory) {
  //return an object to define the "my/shirt" module.
  return {
    color: "blue",
    size: "large",
    addToCart: function () {
      inventory.decrement(this);
      cart.add(this);
    },
  };
});
// ...
require("my/shirt.js").addToCart();
```

<!-- v -->

При этом, если скрипты мы загружаем разными файлами, у нас нет больше ограничение на технологии. Каждый файл (или группа файлов) может использовать свои инструменты (React/Vue/чистый javascript).

Нам только нужно соблюдать интерфейс модулей. Или, для упрощения, сделать так, чтобы подключаемые файлы не предоставляли никакого интерфейса вообще (решается вопрос сопряжения модулей).

<!-- v -->

### Вопросы?

<!-- v -->

Как организовать общение таких независимо загруженных частей?

<!-- v -->

[EventTarget](https://developer.mozilla.org/ru/docs/Web/API/EventTarget)/[postMessage API](https://developer.mozilla.org/ru/docs/Web/API/Window/postMessage)/собственная шина событий

Например [вот так](https://codesandbox.io/s/widget-communication-nsvbw)

<!-- v -->

Как могут активироваться такие части:

- в зависимости от URL (когда за отдельные страницы отвечает свой модуль)
- в зависимости от блоки (когда за отдельные части на странице отвечает свой модуль)
- смешанный подход

<!-- v -->

### Вопросы?

<!-- s -->

### Дополнительные материалы

- [YT: Харин Дмитрий - Микрофронтенд – велосипед или космический корабль?](https://www.youtube.com/watch?v=32OcecQV6lo)
- [YT: Микрофронтенды как решение проблем кратного роста команды](https://www.youtube.com/watch?v=5ekkGugwAEg)
- [YT: Микросервисный фронтенд](https://www.youtube.com/watch?v=YANolrn4PYc)
- [YT: Фронтенд-приложения как микросервисы](https://www.youtube.com/watch?v=pcb2rOX_9Dg)
- [Микрофронтенды. Учимся на ошибках](https://habr.com/ru/post/515418/)
- [YT: Микросервисный фронтенд. Как подружить vue.js и react](https://www.youtube.com/watch?v=XD02n4GXjU8)
